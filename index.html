<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IPL Hand Cricket</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <style>
    .hidden { display: none; }
    .game { padding: 20px; }
    .scoreboard { margin-top: 20px; }
    .waiting { text-align: center; margin-top: 20px; }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="text-center my-4">IPL Hand Cricket</h1>

    <div id="matchmaking">
      <h3>Choose Game Mode</h3>
      <button id="createGameBtn" class="btn btn-primary">Create Game</button>
      <button id="joinGameBtn" class="btn btn-success">Join Game</button>
    </div>

    <div id="gameSetup" class="hidden">
      <h3>Enter Game Details</h3>
      <input type="text" id="playerName" placeholder="Your Name" class="form-control my-2" />
      <input type="text" id="roomName" placeholder="Game Room Name" class="form-control my-2" />
      <input type="number" id="wicketsInput" placeholder="Total Wickets" class="form-control my-2" min="1" />
      
      <h4>Select Your Team:</h4>
      <select id="teamSelection" class="form-control my-2">
        <option value="Team A">Team A</option>
        <option value="Team B">Team B</option>
      </select>
      
      <button id="startGameBtn" class="btn btn-primary">Start Game</button>
    </div>

    <div id="gameArea" class="hidden">
      <h4>Game Mode: <span id="gameMode"></span></h4>
      <div id="scoreboard" class="scoreboard">
        <p>Player: <span id="playerScore">0</span> | Wickets: <span id="playerWickets">0</span></p>
        <p>Opponent: <span id="opponentScore">0</span> | Wickets: <span id="opponentWickets">0</span></p>
      </div>
      <div id="numberButtons" class="my-3">
        <button class="btn btn-outline-secondary numberBtn" data-value="1">1</button>
        <button class="btn btn-outline-secondary numberBtn" data-value="2">2</button>
        <button class="btn btn-outline-secondary numberBtn" data-value="3">3</button>
        <button class="btn btn-outline-secondary numberBtn" data-value="4">4</button>
        <button class="btn btn-outline-secondary numberBtn" data-value="5">5</button>
        <button class="btn btn-outline-secondary numberBtn" data-value="6">6</button>
        <button class="btn btn-outline-secondary numberBtn" data-value="7">7</button>
        <button class="btn btn-outline-secondary numberBtn" data-value="8">8</button>
        <button class="btn btn-outline-secondary numberBtn" data-value="9">9</button>
        <button class="btn btn-outline-secondary numberBtn" data-value="10">10</button>
      </div>
      <div id="message" class="my-3"></div>
    </div>

    <div id="waitingMessage" class="hidden text-center">
      <h3>Waiting for opponent...</h3>
    </div>
    
    <div id="tossResult" class="hidden text-center">
      <h3 id="tossResultMessage"></h3>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/firebase@8.10.1/firebase-app.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/firebase@8.10.1/firebase-database.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/peerjs@1.3.2/dist/peerjs.min.js"></script>
  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyCVYzyWVQ5kkAG9AhDjxTy-qeHsZywFhnE",
      authDomain: "hand-crick.firebaseapp.com",
      databaseURL: "https://hand-crick-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "hand-crick",
      storageBucket: "hand-crick.firebasestorage.app",
      messagingSenderId: "958354848195",
      appId: "1:958354848195:web:397c832b30736738f46576",
      measurementId: "G-0LWG0CNH67"
    };
    firebase.initializeApp(firebaseConfig);

    let peer;
    let conn;
    let playerName = "";
    let roomName = "";
    let gameMode = "";
    let teamSelected = "";
    let totalWickets = 3; // Default wickets
    let playerChoice = null;
    let opponentChoice = null;
    let playerScore = 0;
    let opponentScore = 0;
    let playerWickets = 0;
    let opponentWickets = 0;
    let innings = 1;
    let isTossComplete = false;

    // Initialize PeerJS
    function initPeer() {
      peer = new Peer(undefined, {
        host: 'localhost',
        port: 9000,
        path: '/peerjs'
      });

      peer.on('open', id => {
        console.log('My peer ID is: ' + id);
        document.getElementById('waitingMessage').classList.remove('hidden');
        document.getElementById('waitingMessage').innerHTML = `Waiting for opponent... Peer ID: ${id}`;
      });

      peer.on('connection', incomingConn => {
        conn = incomingConn;
        setupGame();
      });
    }

    // Start game logic
    function startGame() {
      playerName = document.getElementById('playerName').value;
      roomName = document.getElementById('roomName').value;
      totalWickets = parseInt(document.getElementById('wicketsInput').value);
      teamSelected = document.getElementById('teamSelection').value;

      if (!playerName || !roomName || !totalWickets || !teamSelected) {
        alert('Please enter all details including your name, room name, team, and total wickets.');
        return;
      }

      const gameRef = firebase.database().ref('games/' + roomName);
      gameRef.once('value').then(snapshot => {
        if (snapshot.exists()) {
          joinGame(snapshot.val());
        } else {
          createGame();
        }
      });
    }

    // Create game
    function createGame() {
      const gameRef = firebase.database().ref('games').push({
        hostName: playerName,
        roomName: roomName,
        hostPeerId: peer.id,
        totalWickets: totalWickets,
        team: teamSelected
      });

      document.getElementById('gameArea').classList.remove('hidden');
      gameMode = 'Host';
      document.getElementById('gameMode').innerText = gameMode;

      // Toss logic
      performToss();
    }

    // Join game
    function joinGame(gameData) {
      conn = peer.connect(gameData.hostPeerId);
      gameMode = 'Guest';
      document.getElementById('gameMode').innerText = gameMode;
      setupGame();

      // Toss logic for guest
      performToss();
    }

    // Setup the game interface after peer connection is established
    function setupGame() {
      document.getElementById('matchmaking').classList.add('hidden');
      document.getElementById('gameSetup').classList.add('hidden');
      document.getElementById('gameArea').classList.remove('hidden');

      // Listen for opponent's moves
      conn.on('data', data => {
        opponentChoice = data;
        updateGameState();
      });

      document.querySelectorAll('.numberBtn').forEach(button => {
        button.addEventListener('click', () => {
          playerChoice = parseInt(button.dataset.value);
          conn.send(playerChoice);
          updateGameState();
        });
      });
    }

    // Perform toss and decide who will bat first
    function performToss() {
      const tossResult = Math.random() < 0.5 ? 'Heads' : 'Tails';
      document.getElementById('tossResult').classList.remove('hidden');
      document.getElementById('tossResultMessage').innerText = `Toss Result: ${tossResult}`;
      
      setTimeout(() => {
        if (tossResult === 'Heads') {
          document.getElementById('message').innerText = `${gameMode === 'Host' ? 'Host' : 'Guest'} will bat first!`;
        } else {
          document.getElementById('message').innerText = `${gameMode === 'Host' ? 'Guest' : 'Host'} will bat first!`;
        }
      }, 2000);
    }

    // Update game state with new choices and wickets
    function updateGameState() {
      if (playerChoice && opponentChoice) {
        if (playerChoice === opponentChoice) {
          playerWickets++;
        } else {
          playerScore++;
        }

        document.getElementById('playerScore').innerText = playerScore;
        document.getElementById('playerWickets').innerText = playerWickets;
            // Check for end of innings or match
    if (playerWickets >= totalWickets) {
      innings++;
      playerWickets = 0;
      opponentWickets = 0;
      document.getElementById('message').innerText = `Innings ${innings} has started!`;
    }
  }
}

// Event listeners
document.getElementById('createGameBtn').addEventListener('click', () => {
  document.getElementById('matchmaking').classList.add('hidden');
  document.getElementById('gameSetup').classList.remove('hidden');
  initPeer();
});

document.getElementById('startGameBtn').addEventListener('click', startGame);
</script> </body> </html>