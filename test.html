<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hand Cricket Game</title>
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f8ff;
    }
    .container {
      margin-top: 50px;
    }
    .btn {
      margin: 10px;
    }
    #game-section {
      display: none;
    }
    #stats {
      margin-top: 20px;
    }
  </style>
</head>
<body>

<div class="container">
  <h1>Hand Cricket Game</h1>

  <!-- Toss Section -->
  <div id="toss-section">
    <h3>Choose Odd or Even for Toss:</h3>
    <button id="odd" class="btn btn-primary">Odd</button>
    <button id="even" class="btn btn-primary">Even</button>
    <div id="toss-result" class="mt-3"></div>
  </div>

  <!-- Number Selection Section -->
  <div id="game-section">
    <h3>Choose Your Number (0-10):</h3>
    <input type="number" id="player-choice" min="0" max="10" class="form-control" style="width: 100px; margin-bottom: 10px;">
    <button id="submit-choice" class="btn btn-success">Submit</button>
    <div id="game-result" class="mt-3"></div>
  </div>

  <!-- Stats Section -->
  <div id="stats">
    <h4>Game Stats:</h4>
    <p id="player-stats"></p>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/peerjs@1.3.2/dist/peerjs.min.js"></script>
<script>
  // Initialize PeerJS and game variables
  const peer = new Peer();
  let currentGame = {
    tossWinner: null,
    currentTurn: "bat",
    teamChoice: [],
    wickets: 0,
    totalRuns: 0,
    innings: 0
  };

  let connection = null;

  // When peer is ready, log the peer ID
  peer.on('open', function(id) {
    console.log('My peer ID is ' + id);
  });

  // Handle incoming connections
  peer.on('connection', function(conn) {
    connection = conn;
    connection.on('data', function(data) {
      console.log('Received data: ', data);
      // Handle data received from peer (opponent)
      if (data.type === 'numberChosen') {
        handleOpponentChoice(data.choice);
      }
    });
  });

  // Toss Logic: Handle Odd/Even choice
  document.getElementById('odd').addEventListener('click', function() {
    handleToss("odd");
  });

  document.getElementById('even').addEventListener('click', function() {
    handleToss("even");
  });

  function handleToss(choice) {
    const tossSum = Math.floor(Math.random() * 10) + Math.floor(Math.random() * 10);
    const tossResult = (tossSum % 2 === 0) ? "even" : "odd";
    currentGame.tossWinner = tossResult === choice ? "Team 1" : "Team 2";
    document.getElementById('toss-result').innerHTML = `${currentGame.tossWinner} wins the toss! They decide to bat.`;
    document.getElementById('toss-section').style.display = 'none';
    document.getElementById('game-section').style.display = 'block';
    startInnings();
  }

  // Start innings based on toss winner
  function startInnings() {
    document.getElementById('submit-choice').addEventListener('click', function() {
      const playerChoice = document.getElementById('player-choice').value;
      if (playerChoice !== "") {
        currentGame.teamChoice.push(playerChoice);
        connection.send({ type: 'numberChosen', choice: playerChoice });
        evaluateChoices(playerChoice);
      }
    });
  }

  // Handle opponent's choice (after sending our choice)
  function handleOpponentChoice(choice) {
    if (currentGame.teamChoice.length === 1) {
      evaluateChoices(choice);
    }
  }

  // Evaluate choices
  function evaluateChoices(opponentChoice) {
    const playerChoice = currentGame.teamChoice[0];
    let resultMessage = "";

    // Same number => Out
    if (playerChoice == opponentChoice) {
      resultMessage = "Out! Both teams chose the same number.";
    }
    // Batting logic for 0 choices
    else if (playerChoice == "0" && opponentChoice != "0") {
      currentGame.totalRuns += parseInt(opponentChoice);
      resultMessage = `Bowler scores ${opponentChoice} runs!`;
    }
    // Handle 'Same or Difference' game
    else if (playerChoice == "0" && opponentChoice == "0") {
      resultMessage = "Both chose 0! Entering 'Same or Difference' game...";
      sameOrDifferenceGame();
    }

    document.getElementById('game-result').innerHTML = resultMessage;
    updateStats();
  }

  // Same or Difference Game
  function sameOrDifferenceGame() {
    const randomChoice = Math.floor(Math.random() * 2) + 1;
    alert(`Both teams will choose 1 or 2 for the 'Same or Difference' game. Team 1, choose your number: ${randomChoice}`);
  }

  // Update Stats
  function updateStats() {
    document.getElementById('player-stats').innerHTML = `
      Runs: ${currentGame.totalRuns} | Wickets: ${currentGame.wickets} | Innings: ${currentGame.innings}
    `;
  }
</script>

</body>
</html>
